import streamlit as st
from PIL import Image
import requests
from io import BytesIO
import time
import os

# -------------------------------
# PAGE CONFIG
# -------------------------------
st.set_page_config(
    page_title="Smart OCR Extractor",
    page_icon="ğŸ§ ",
    layout="wide"
)

# -------------------------------
# CUSTOM STYLING (Modern Clean UI)
# -------------------------------
st.markdown("""
<style>
.main {
    padding-top: 20px;
}
.stButton>button {
    width: 100%;
    height: 45px;
    font-size: 16px;
    border-radius: 8px;
}
.stTextInput>div>div>input {
    border-radius: 8px;
}
.stFileUploader {
    border-radius: 8px;
}
.status-box {
    padding: 10px;
    border-radius: 8px;
    font-weight: bold;
}
</style>
""", unsafe_allow_html=True)

# -------------------------------
# HEADER
# -------------------------------
st.title("ğŸ§  Smart OCR Extractor")
st.caption("Modern Image Text Extraction Tool")

st.divider()

# -------------------------------
# IMAGE INPUT SECTION
# -------------------------------
st.subheader("ğŸ“¥ Provide Image Source")

col1, col2 = st.columns(2)

with col1:
    image_url = st.text_input("ğŸŒ Enter Image URL")

    local_path = st.text_input("ğŸ“‚ Enter Local File Path")

with col2:
    uploaded_file = st.file_uploader(
        "ğŸ–¼ï¸ Upload Image",
        type=["png", "jpg", "jpeg"]
    )

# -------------------------------
# IMAGE PREVIEW
# -------------------------------
st.subheader("ğŸ–¼ï¸ Image Preview")

image = None
error_message = None

try:
    if image_url:
        response = requests.get(image_url, timeout=5)
        if response.status_code == 200:
            image = Image.open(BytesIO(response.content))
        else:
            error_message = "Unable to fetch image from URL."

    elif local_path:
        if os.path.exists(local_path):
            image = Image.open(local_path)
        else:
            error_message = "Local file path does not exist."

    elif uploaded_file:
        image = Image.open(uploaded_file)

    if image:
        st.image(image, use_container_width=True)
    elif error_message:
        st.error(error_message)

except Exception as e:
    st.error("Error loading image.")

# -------------------------------
# EXECUTE BUTTON
# -------------------------------
st.divider()
st.subheader("âš™ï¸ Process Image")

status_placeholder = st.empty()
result_placeholder = st.empty()

if st.button("ğŸš€ Execute Extraction"):

    if image is None:
        status_placeholder.error("âŒ No valid image provided.")
    else:
        status_placeholder.info("â³ Processing... Please wait")
        time.sleep(2)  # simulate processing time

        # Placeholder result (OCR will come in Phase 2)
        extracted_text = "Sample extracted text will appear here after OCR integration."

        status_placeholder.success("âœ… Extraction Completed Successfully!")

        result_placeholder.subheader("ğŸ“„ Extracted Text")
        result_placeholder.text_area(
            "Result",
            extracted_text,
            height=200
        )

        st.download_button(
            "ğŸ“‹ Copy / Download Text",
            extracted_text,
            file_name="extracted_text.txt"
        )

# -------------------------------
# FOOTER
# -------------------------------
st.divider()
st.caption("Built with Streamlit â€¢ Phase 1 UI Completed")
